!function(e){var t={};function r(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(a,s,function(t){return e[t]}.bind(null,s));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);class a{constructor(e){this.blocks=e,this.hitPlaces=new Array(e).fill(0),this.sunk=!1}hit(e){this.hitPlaces[e]=1}isSunk(){let e;return e=!!this.hitPlaces.every(e=>1===e),e}getData(){return{blocks:this.blocks,hitPlaces:this.hitPlaces,sunk:this.sunk}}}class s{constructor(){this.board=Array(10).fill(-1).map(()=>Array(10).fill(-1)),this.ships=[]}placeShip(e,t,r){const s=new a(e);for(let a=0;a<e;a++)this.board[t][r+a]=this.ships.length;this.ships.push({ship:s,start:r})}receiveAttack(e,t){const r=this.board[e][t];switch(r){case"hit":case"miss":return r;case-1:this.board[e][t]="miss";break;default:const a=this.ships[r];a.ship.hit(t-a.start),a.ship.isSunk()?this.shipHitBoard(a,e):this.board[e][t]="hit"}}shipHitBoard(e,t){for(let r=0;r<e.ship.blocks;r++)this.board[t][e.start+r]="sunk"}allSunk(){return this.ships.every(e=>e.ship.isSunk())}}class n{constructor(e,t=!1){this.isPc=t,this.name=e,this.attacked=[],this.boats=[[null,5],[null,5],[null,3],[null,1],[null,1]],this.gameBoard=new s}attack(){let e;do{e=this.getCoordinates()}while(this.CoordinatesAttacked(e));return this.attacked.push(e),e}CoordinatesAttacked(e){for(let t=0;t<this.attacked.length;t++)if(this.attacked[t][0]===e[0]&&this.attacked[t][1]===e[1])return!0;return!1}boatInPlace(e,t){let r=e[0],a=e[1];return this.boats.some(e=>{if(e[0]&&e[0][0]===r&&a+t>=e[0][1]&&a<=e[0][1]+e[1])return!0})}boatFit(e,t){return e+t<10}putBoats(){return this.boats.forEach(e=>{let t;do{t=this.getCoordinates()}while(this.boatInPlace(t,e[1])||!this.boatFit(t[1],e[1]));e[0]=t}),this.boats.forEach(e=>{this.gameBoard.placeShip(e[1],e[0][0],e[0][1])}),!0}getCoordinates(){return[Math.floor(10*Math.random()),Math.floor(10*Math.random())]}}const o=(()=>{const e={};return{on:(t,r)=>{e[t]=e[t]||[],e[t].push(r)},off:(t,r)=>{if(e[t])for(let a=0;a<e[t].length;a+=1)if(e[t][a]===r){e[t].splice(a,1);break}},emit:(t,r)=>{e[t]&&e[t].forEach(e=>{e(r)})}}})();class l{constructor(){this.playerOne=null,this.playerTwo=null,this.currentPlayer=null,this.nextPlayer=null}createPlayers(e){const t=e.playerOne,r=e.playerTwo;this.playerOne=new n(t[0],t[1]),this.playerTwo=new n(r[0],r[1]),this.currentPlayer=this.playerOne,this.nextPlayer=this.playerTwo}placeShips(){this.dragAndDropBoat(),this.playerTwo.putBoats(),o.emit("board changed",this.playerTwo)}doShoot(e=null,t=null){let r=e,a=t;"pc"===this.currentPlayer.name&&([r,a]=this.currentPlayer.attack()),"miss"!==this.nextPlayer.gameBoard.board[r][a]&&"hit"!==this.nextPlayer.gameBoard.board[r][a]&&(this.nextPlayer.gameBoard.receiveAttack(r,a),o.emit("player attack",this.nextPlayer),this.currentPlayer=this.nextPlayer,this.currentPlayer===this.playerOne?this.nextPlayer=this.playerTwo:this.nextPlayer=this.playerOne)}dragAndDropBoat(){o.on("boat dragged and dropped",e=>{let t=+e[0][0],r=+e[0][1],a=e[1];this.playerOne.gameBoard.placeShip(a,t,r)}),o.emit("board changed",this.playerOne)}}function i(e){const t=document.getElementById(e);for(let e=0;e<10;e++){const r=document.createElement("div");r.classList.add("gridRow");for(let t=0;t<10;t++){const a=document.createElement("div");a.classList.add("gridSquare"),a.setAttribute("data-coordinates",""+[e,t]),r.appendChild(a)}t.appendChild(r)}}function d(e){let t=e.gameBoard.board,r="pc"===e.name?"playerTwoBoard":"playerOneBoard";const a=c(r);for(let e=0;e<10;e++)for(let s=0;s<10;s++){let n=t[e][s],o=a[e][s];switch(n){case-1:o.classList.add("watter");break;case"hit":o.style.backgroundColor="orange";break;case"miss":o.style.backgroundColor="grey";break;case"sunk":o.style.backgroundColor="red";break;default:o.style.backgroundColor="playerTwoBoard"===r?"blue":"green"}}}function c(e){return Array.from(document.getElementById(e).childNodes).map(e=>Array.from(e.childNodes))}!function(){const e=new l;o.on("create players",t=>{e.createPlayers(t),o.emit("board changed",e.playerOne),o.emit("board changed",e.playerTwo),async function(e){e.placeShips(),await new Promise(e=>{o.on("all boats droped",()=>e())});do{await new Promise(async t=>{if("pc"!==e.currentPlayer.name){let[r,a]=await new Promise(e=>o.on("square clicked",t=>e(t)));e.doShoot(r,a),t()}else e.doShoot(),t()})}while(!e.playerOne.gameBoard.allSunk()&&!e.playerTwo.gameBoard.allSunk());window.alert("gameOver")}(e)})}(),i("playerTwoBoard"),i("playerOneBoard"),c("playerTwoBoard").forEach((e,t)=>{e.map((e,r)=>{e.addEventListener("click",()=>o.emit("square clicked",[t,r]))})}),o.on("boat dragged and dropped",e=>{let t=+e[0][0],r=+e[0][1],a=e[1],s=c("playerOneBoard");for(let e=0;e<a;e++)s[t][r+e].style.backgroundColor="green"}),o.on("player attack",d),o.on("board changed",d),o.emit("create players",{playerOne:["tin",!0],playerTwo:["pc",!1]}),function(){let e=document.querySelectorAll(".draggableBoat");function t(e){let t=e.dataset.coordinates;return t=e.dataset.coordinates.split(","),t}function r(e,r){return+t(e)[1]+r<11}document.getElementById("playerOneBoard").querySelectorAll(".gridSquare").forEach(e=>{e.addEventListener("dragover",e=>e.preventDefault()),e.addEventListener("dragenter",t=>{t.preventDefault();let a=+document.getElementsByClassName("dragging")[0].dataset.squares;r(e,a)?e.classList.add("validDrop"):e.classList.add("invalidDrop")}),e.addEventListener("dragleave",()=>{e.classList.remove("invalidDrop"),e.classList.remove("validDrop")}),e.addEventListener("drop",()=>{let a=document.getElementsByClassName("dragging")[0],s=+a.dataset.squares;if(e.classList.remove("invalidDrop"),e.classList.remove("validDrop"),r(e,s)){a.remove();let r=t(e);return o.emit("boat dragged and dropped",[r,s]),0===document.querySelectorAll(".draggableBoat").length&&o.emit("all boats droped",null),[r,s]}})}),e.forEach(e=>{e.addEventListener("dragstart",()=>e.classList.add("dragging")),e.addEventListener("dragend",()=>e.classList.remove("dragging"))})}()}]);